//Sets out->quotient to 0 when the coefficients of the quotient wouldn't be in the ring.
void %main.type_name%_euclidean_divide(struct Stack*restrict output_stack, struct Stack*restrict local_stack, struct %main.base_type%Division*out, struct %main.base_type%*dividend, struct %main.base_type%*divisor)
{
    if (divisor->coefficient_count > dividend->coefficient_count)
    {
        out->quotient = %main.additive_identity%;
        out->remainder = %main.base_type_name%_copy(output_stack, dividend);
        return;
    }
    void*local_stack_savepoint = local_stack->cursor;
    out->quotient = polynomial_allocate(output_stack, 1 + dividend->coefficient_count - divisor->coefficient_count);
    out->remainder = polynomial_allocate(output_stack, dividend->coefficient_count);
    memcpy(out->remainder->coefficients, dividend->coefficients, dividend->coefficient_count * sizeof(void*));
    while (out->remainder->coefficient_count >= divisor->coefficient_count)
    {
        --out->remainder->coefficient_count;
        struct %coefficient.base_type%Division division;
        %coefficient.type_name%_euclidean_divide(local_stack, output_stack, &division, out->remainder->coefficients[out->remainder->coefficient_count], divisor->coefficients[divisor->coefficient_count - 1]);
        if (%coefficient.base_type_name%_equals(division.remainder, %coefficient.additive_identity%))
        {
            out->quotient->coefficients[out->remainder->coefficient_count + 1 - divisor->coefficient_count] = division.quotient;
            for (size_t i = 1; i < divisor->coefficient_count; ++i)
            {
                out->remainder->coefficients[out->remainder->coefficient_count - i] =
                    %coefficient.subtract%(local_stack, output_stack, out->remainder->coefficients[out->remainder->coefficient_count - i],
                        %coefficient.multiply%(local_stack, output_stack, division.quotient, divisor->coefficients[divisor->coefficient_count - i - 1]));
            }
        }
        else
        {
            out->quotient = 0;
            local_stack->cursor = local_stack_savepoint;
            return;
        }
    }
    %main.base_type_name%_copy_coefficients(output_stack, out->quotient);
    %main.base_type_name%_trim_leading_zeroes(out->remainder);
    %main.base_type_name%_copy_coefficients(output_stack, out->remainder);
    local_stack->cursor = local_stack_savepoint;
}